---
title: "Gov 50 Final Project"
author: "Atticus Lee"
description: "My final project"
output:
  distill::distill_article:
    self_contained: false
---

```{r}
## Packages
library(tidyverse)
library(ggplot2)
library(infer)
library(dplyr)
library(broom)

cwed <- read_csv("cwed.csv")
cwed
```

```{r}
## Data Simplification
cwed <- cwed |>
  rename(country = COUNTRY,
         year = YEAR,
         wage = APWWage,
         UI_rep_single = US100,
         UI_rep_family = UC1000,
         UI_qual = UEQUAL,
         UI_duration = UEDUR,
         UI_wait = UEWAIT,
         UI_cov = UECOV,
         SI_rep_single = SS100,
         SI_rep_family = SC1000,
         SI_qual = SICKQUAL,
         SI_duration = SICKDUR,
         SI_wait = SICKWAIT,
         SI_cov = SICKCOV,
         MinPen_rep_single = MPS100,
         MinPen_rep_family = MPC1000,
         pen_rep_single = SPS100,
         pen_rep_family = SPC1000,
         pen_qual = PQUAL,
         pen_ratio = PFUND,
         pen_years = AVGPER,
         pen_cov = PENCOV,
         male_retirement = MRET,
         female_retirement = FRET,
         life_exp = LEXP65) |> 
  mutate(life_exp = life_exp + 65)
```


## Introduction
Welfare programs have long been controversial. Proponents argue that public insurance and pensions help the elderly and those down on their luck. They believe that the higher welfare benefits for the unemployed, sick, and elderly provide a much-needed economic cushion that allows recipients to spend more on essentials and improve their well-being. This project seeks to bring clarity to this issue by exploring how welfare benefits can affect people's lives. Specifically, the project focuses on how the size of benefits for different types of insurance impacts life expectancy. It asks: Does the single replacement rate (the percentage of an individual's income given as insurance benefits) for Unemployment Insurance, Sickness Insurance, and Pensions affect life expectancy at the age of 65? This question may help frame the debate around welfare benefits, an issue that affects, in one way or another, hundreds of millions of people across the globe.

## Data and Research Design
Data for this project is used from The Comparative Welfare Entitlements Dataset (CWED), which has data on various institutional features of social insurance programs in 33 countries spanning much of the post-war period. The three social programs in the CWED data are Unemployment Insurance, Sickness Insurance, and Pensions.

The analyses covers the following features for Unemployment Insurance and Sickness Insurance:
- Single Replacement Rate: the percentage of an individual's annual employment income that is given as benefits
- Family Replacement Rate: the percentage of a family's annual employment income that is given as benefits
- Waiting days: Days one must wait to start receiving benefit after becoming unemployed/sick
- Qualification period: Weeks of insurance needed to qualify for benefit
- Duration: Weeks of benefit entitlement excluding times of means‐tested assistance or long‐term disability/invalidity pensions
- Coverage: Percentage of the labor force insured for unemployment risk/sick-pay insurance

The analyses covers the following features for Pensions:
- Minimum Pension Single Replacement Rate: the percentage of an individual's annual employment income that is given as benefits
- Minimum Pension Family Replacement Rate: the percentage of a family's annual employment income that is given as benefits
- Standard Pension Single Replacement Rate: the percentage of an individual's annual employment income that is given as benefits
- Standard Pension Family Replacement Rate: the percentage of a family's annual employment income that is given as benefits
- Coverage/Take‐up: Portion of those above official retirement age who are in receipt
of a public pension
- “Standard” number of years of pension insurance to be considered fully covered
- The ratio of employee pension contributions to employer and employee pension contributions
- Years of earnings used in the pensionable wage calculation

The research design is time series cross sectional, as it observes 1,386 samples across 33 countries from 1970 to 2011 to analyze the relationship between the main explanatory variables (unemployment, sickness, and pension replacement rates), and the outcome variable (life expectancy at age 65).

This is the distribution of the outcome variable for all samples:
```{r}
ggplot(data = cwed, mapping = aes(x = life_exp)) +
  geom_histogram(aes(y = ..density..)) +
  labs(x = "Life Expectanct at Age 65",
       y = "Density",
       title = "Distribution of Life Expectancy")
```

This is how the outcome variable changed over time in each country. The blue line represent the line of best fit for the aggregate data.
```{r}
ggplot(data = cwed, mapping = aes(x = year,
                       y = life_exp)) +
  geom_line(mapping = aes(group = country), color = "grey70") +
  geom_smooth(method = "loess") +
  labs(x = "Year",
       y = "Life Expectancy",
       title = "Average Life Expectancy at age 65 Over Time")
```

## Results

```{r}
## Bivariate Plots

ggplot() + 
  geom_smooth(data = cwed, mapping = aes(x = UI_rep_single, 
                       y = life_exp), method = "lm")

ggplot() + 
  geom_smooth(data = cwed, mapping = aes(x = SI_rep_single, 
                       y = life_exp), method = "lm")

ggplot() + 
  geom_smooth(data = cwed, mapping = aes(x = MinPen_rep_single, 
                       y = life_exp), method = "lm")

```

The bivariate plots suggests that there exists positive relationships between single replacement rates of the three major types of insurance and life expectancy at the age of 65. Regression analyses will give a better insight on this relationship.


```{r}
## Regression 1
m.lm1 <- lm(data = cwed, life_exp ~ UI_rep_single + SI_rep_single + MinPen_rep_single + as.factor(year) + country)

summary(m.lm1)$coefficients[1:4,] |>
  knitr::kable(digits = 2)
```
The following regression is a multivariate model to analyze the relationship between the three main explanatory variables and the outcome variable with year and country fixed effects included but not shown in the final table.


```{r}
## Regression 2
m.lm2 <- lm(life_exp ~ UI_rep_single + UI_rep_family + SI_rep_single + SI_rep_family + MinPen_rep_single + MinPen_rep_family + pen_rep_single + pen_rep_family + UI_cov + UI_wait + SI_cov + SI_wait + pen_cov + pen_ratio + UI_qual + SI_qual + pen_qual + wage + country + as.factor(year), data = cwed)

summary(m.lm2)$coefficients[1:19,] |>
  knitr::kable(digits = 2)
```
The following regression is a multivariate model to analyze the relationship between the three main explanatory variables and the outcome variable controlling for other features of the insurance programs. Year and country fixed effects are included but not shown in the final table.

Each one unit increase in SI_rep_single leads to a 2.085e+00 increase in life expectancy when holding all other variables constant. The relationship is statistically significant. 

(define one unit increase)

## Conclusion

- shortcomings
- if i had unlimited resources what would I do to improve: unethical randomized trial (explain importance of randomization for eliminating confounding variables)
- what are potential confounders

